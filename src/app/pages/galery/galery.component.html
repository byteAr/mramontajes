
<!-- Grid de miniaturas cuadradas estilo Instagram -->
<p class="text-center mb-5 text-[1.5rem] font-bold italic">GALERIA</p>
<div class="grid grid-cols-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 mx-2 mb-5">
  <button
    type="button"
    class="group cursor-pointer relative aspect-square overflow-hidden rounded-xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white/50"
    *ngFor="let img of normalizedImages(); let i = index"
    (click)="open(i)"
    aria-label="Abrir imagen en grande"
  >
    <img
      class="h-full w-full object-cover transition-transform duration-200 group-hover:scale-105"
      [src]="img.src"
      loading="lazy"
      decoding="async"
    />
  </button>
</div>

<!-- Overlay / Lightbox -->
<div
  *ngIf="isOpen()"
  #overlay
  tabindex="-1"
  class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm outline-none"
  (click)="onBackdrop($event)"
  role="dialog"
  aria-modal="true"
  [attr.aria-label]="(current()?.alt ?? 'Visor de imágenes')"
>
  <div class="relative max-w-6xl w-full max-h-[90vh]">
    <!-- Imagen grande -->
    <img
      class="mx-auto max-h-[82vh] w-auto select-none rounded-xl shadow-2xl"
      [src]="current()?.src"
      [alt]="current()?.alt || 'Imagen seleccionada'"
      (click)="$event.stopPropagation()"
      draggable="false"
    />

    <!-- Controles izquierda/derecha -->
    <div class="absolute inset-y-0 left-0 flex items-center">
      <button
        type="button"
        (click)="prev()"
        class="m-2 rounded-full p-3 bg-white/20 hover:bg-white/30 backdrop-blur focus:outline-none cursor-pointer"
        aria-label="Anterior"
      >
        <!-- Icono Flecha Izquierda -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6 text-white">
          <path fill-rule="evenodd" d="M15.78 4.72a.75.75 0 0 1 0 1.06L9.56 12l6.22 6.22a.75.75 0 0 1-1.06 1.06l-6.75-6.75a.75.75 0 0 1 0-1.06l6.75-6.75a.75.75 0 0 1 1.06 0z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>
    <div class="absolute inset-y-0 right-0 flex items-center">
      <button
        type="button"
        (click)="next()"
        class="m-2 rounded-full p-3 bg-white/20 hover:bg-white/30 backdrop-blur focus:outline-none cursor-pointer"
        aria-label="Siguiente"
      >
        <!-- Icono Flecha Derecha -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6 text-white">
          <path fill-rule="evenodd" d="M8.22 19.28a.75.75 0 0 1 0-1.06L14.44 12 8.22 5.78a.75.75 0 1 1 1.06-1.06l6.75 6.75a.75.75 0 0 1 0 1.06l-6.75 6.75a.75.75 0 0 1-1.06 0z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>

    <!-- Botón cerrar -->
    <button
      type="button"
      (click)="close()"
      class="absolute top-1 right-2 rounded-full p-2 bg-white/20 hover:bg-white/30 backdrop-blur focus:outline-none cursor-pointer"
      aria-label="Cerrar"
    >
      <!-- Icono X -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6 text-white">
        <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06z" clip-rule="evenodd"/>
      </svg>
    </button>

    <!-- Pie de foto (opcional) -->
    <div class="absolute -bottom-10 left-0 right-0 text-center text-white/90" *ngIf="current()?.alt as alt">
    </div>
  </div>
</div>
